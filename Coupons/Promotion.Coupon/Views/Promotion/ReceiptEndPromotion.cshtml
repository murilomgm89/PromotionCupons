@using Promotion.Coupon.Entity.Extensions
@model Promotion.Coupon.Models.EndPromotionViewModel

@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ReceiptFinalWinner</title>
    <link rel="stylesheet" href="/Content/css/index.css">
	
    @*<script src="//assets.adobedtm.com/9b74220da1d0b361973dbd26a530b8f49255d00c/satelliteLib-b69ce53ba3fa1db9f06b40a159d15cee47132b4e.js"></script>*@
</head>
<body>   
    <form action="/promotion/receipt/save" method="post" enctype="multipart/form-data" name="internal.frm" autocomplete="off">      
        <div class="cupom">
             <header>
                <span class="disable">
                    <strong>Dados Pessoais</strong>
                    <small>Os campos marcados com * são de preenchimento obrigatório</small>
                </span>
                <span>
                    <strong>Cadastro do Cupom</strong>
                    <small>@*Envie uma foto do cupom fiscal.*@</small>
                </span>
                <a href="javascript:;">&times;</a>
            </header> 
            <div>
                <h2 class="success">
                    <strong>Essa promoção já acabou.</strong>
                </h2>
                <h2 class="success">            		
            		Quer saber se você foi um dos ganhadores?<br />Confira abaixo se um dos seus cupons foi sorteado.
            	</h2>
            	<p>
                    Fique ligado em nossas proximas promoções e não deixe de participar!
            	</p>            	
            </div>
        </div>
        @{
            if (Model.Receipts.Count >= 1)
            {
                <div class="enviados">
                    <h3>Histórico de Cupons Enviados</h3>
                    <ul class="abas">

                        @if (Model.Receipts.Where(rs => rs.Product.type == "v-power").Count() > 0)
                        {
                            <li><span class="active">V-Power</span></li>                            
                        }
                        
                        @if (Model.Receipts.Any(rs => rs.Product.type == "lubrificantes"))
                        {                           
                            <li><span class="active">Lubrificantes</span></li>
                        }
                    </ul>
                    <div>
                        @{
                        var isWinnerClass = "";
                        var listCupom = "";
                        var len = 0;
                        if (Model.Receipts.Any(rs => rs.Product.type == "v-power"))
                        {
                            <ul class="vpower active">
                                @foreach (var receipt in Model.Receipts.Where(rs => rs.Product.type == "v-power"))
                                {
                                    if (receipt.isWinner == true)
                                    {
                                        isWinnerClass = " class='premiado'";
                                    }
                                    @Html.Raw("<li><span>CNPJ Estabelecimento: " + receipt.vendorCNPJ + "</span><a href='/receipt/file?id=" + receipt.idReceipt.ToString().Base64Encode() + "'" + isWinnerClass + " target='_blank'>ver imagem do cupom</a></li>");
                                    isWinnerClass = "";
                                }
                            </ul>
                        }

                        if (Model.Receipts.Any(rs => rs.Product.type == "lubrificantes"))
                        {
                            <ul class="lub">
                                @foreach (var receipt in Model.Receipts.Where(rs => rs.Product.type == "lubrificantes"))
                                {
                                    listCupom = "";
                                    len = receipt.LuckyCode.Count();
                                    for (int i = 0; i < len; i++)
                                    {
                                        var lucky = receipt.LuckyCode.ElementAt(i);
                                        isWinnerClass = lucky.isWinner == true ? " class='premiado'" : "";
                                        listCupom += "<tr " + Html.Raw(isWinnerClass) + ">";
                                        if (i == 0)
                                        {
                                            listCupom += "<td class='td1' rowspan='" + len + "'>" + String.Format("{0:dd/MM/yyyy}", receipt.dtCreation) + "</td>";
                                        }
                                        var dt = String.Format("{0:dd/MM/yyyy}", lucky.dtRaffle);
                                        listCupom += "<td class='td2'>" + dt + "</td>";
                                        listCupom += "<td class='td3'>" + (lucky.code.ToString().Length == 6 ? lucky.code.ToString().Insert(1, "-") : (lucky.code.ToString().Length == 7 ? lucky.code.ToString().Insert(2, "-") : (lucky.code.ToString().Length == 8 ? lucky.code.ToString().Insert(3, "-") : ""))) + "</td>";
                                        listCupom += "<td class='td4'><span></span></td></tr>";
                                    }
                                    @Html.Raw("<li><span>CNPJ Estabelecimento: " + receipt.vendorCNPJ + "</span><a href='/receipt/file?id=" + receipt.idReceipt.ToString().Base64Encode() + "' target='_blank'>ver imagem do cupom</a>");
                                    @Html.Raw("<table class='cupom'><thead><tr><th class='th1'>Data do cadastro</th><th class='th2'>Data do sorteio</th><th class='td3'>Número da Sorte</th><th class='td4'>Resultado</th></tr></thead>");
                                    @Html.Raw("<tbody>" + @listCupom + "</tbody></table></li>");
                                }
                            </ul>
                        }
                        }
                    </div>
                </div>
            }
        }
        </form>
    <script src="/Scripts/js.js"></script>
</body>
</html>
